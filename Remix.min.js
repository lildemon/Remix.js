(function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};!function(t){"function"==typeof define&&null!=define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):this.Remix=t("undefined"==typeof jQuery?Zepto:jQuery)}(function(r){var o,s,u,l,p,a,h;return s={bind:function(t,e){var n,i,r,o,s;for(n=t.split(" "),this.hasOwnProperty("_callbacks")||this._callbacks||(this._callbacks={}),o=0,s=n.length;s>o;o++)i=n[o],(r=this._callbacks)[i]||(r[i]=[]),this._callbacks[i].push(e);return this},one:function(t,e){var n;return this.bind(t,n=function(){return this.unbind(t,n),e.apply(this,arguments)})},trigger:function(){var e,n,i,r,o,s,u;if(e=1<=arguments.length?t.call(arguments,0):[],i=e.shift(),r=null!=(u=this._callbacks)?u[i]:void 0){for(o=0,s=r.length;s>o&&(n=r[o],n.apply(this,e)!==!1);o++);return!0}},unbind:function(t,e){var n,i,r,o,s,u,l,p,a,h;if(0===arguments.length)return this._callbacks={},this;if(!t)return this;for(i=t.split(" "),u=0,p=i.length;p>u;u++)if(s=i[u],o=null!=(h=this._callbacks)?h[s]:void 0)if(e){for(r=l=0,a=o.length;a>l;r=++l)if(n=o[r],n===e){o=o.slice(),o.splice(r,1),this._callbacks[s]=o;break}}else delete this._callbacks[s];return this}},s.on=s.bind,s.off=s.unbind,l={trace:!0,logPrefix:"(Remix)",log:function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],this.trace?(this.logPrefix&&e.unshift(this.logPrefix),"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,e),this):void 0}},h=["included","extended"],p=function(){function t(){"function"==typeof this.init&&this.init.apply(this,arguments)}return t.include=function(t){var n,i,r;if(!t)throw new Error("include(obj) requires obj");for(n in t)i=t[n],e.call(h,n)<0&&(this.prototype[n]=i);return null!=(r=t.included)&&r.apply(this),this},t.extend=function(t){var n,i,r;if(!t)throw new Error("extend(obj) requires obj");for(n in t)i=t[n],e.call(h,n)<0&&(this[n]=i);return null!=(r=t.extended)&&r.apply(this),this},t.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t.prototype.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t}(),r.parseHTML=r.parseHTML||function(t){return t},o=function(e){function o(t,e){if(this.parent=t,e)this.node=r(e);else if(this.constructor.noTemplate)throw"No template component must created with node";this.child_components={},this.state=this._getInitialState(),this.refs={},this._initialRender=!0,this._parseRemixChild(),this._parseNode(),this._runMixinMethod("initialize"),this.initialize()}return i(o,e),o.include(s),o.extend(s),o.loadTemplate=function(t){var e,n;if(null==t)return void(this.noTemplate=!0);if("string"==typeof t)return~t.indexOf("<")?this.templateNode=r(r.parseHTML(t)):(n=r.get(t),n.done(function(t){return function(e){return t.templateNode=r(r.parseHTML(e))}}(this)),e=function(t){return function(){return t.templateNode=r(r.parseHTML("<span>Error loading template: "+templateStr+" </span>"))}}(this),n.fail(e),n.complete(function(t){return function(){return t.trigger("template-loaded")}}(this)));if(t.nodeType&&1===t.nodeType)return this.templateNode=t;throw"What kind of template is this?"},o.prototype.initialize=function(){},o.prototype.getInitialState=function(){},o.prototype.onNodeCreated=function(){},o.prototype.addChild=function(t,e){return this[t]=e.setParent(this)},o.prototype.setState=function(t){return this._optimistRender(t)},o.prototype.render=function(){return this.trigger("updated"),this.node},o.prototype.appendTo=function(t){return this.node.appendTo(t),this},o.prototype.nodeTrigger=function(){return this.node.trigger.apply(this.node,arguments)},o.prototype.delegateTo=function(t){return this.parent._delChildComp(this.constructor,this.key),t._regChildComp(this,this.constructor,this.key),this.parent=t,this.creator=this.creator.setParent(t),this},o.prototype.delegate=function(t){return t.delegateTo(this)},o.prototype.append=function(t,e){var n;return null==e&&(e=this.node),"function"==typeof t?(n=t(),e.append(n.node?n.node:n),"function"==typeof n.delegateTo&&n.delegateTo(this)):t instanceof o?(e.append(t.node),t.delegateTo(this)):e.append(t),this},o.prototype.include=function(t,e){return null!=e&&"function"==typeof e.empty&&e.empty(),this.append.apply(this,arguments)},o.prototype.empty=function(){return this.node.empty()},o.prototype.destroy=function(t){var e,i,r,o,s;this._runMixinMethod("onDestroy"),"function"==typeof this.onDestroy&&this.onDestroy(),t||this.node.remove(),s=this.child_components;for(e in s)if(n.call(s,e)){o=s[e];for(r in o)n.call(o,r)&&(i=o[r],i.destroy(!0))}return this.off(),this.node.off(),this.parent._delChildComp(this.constructor,this.key)},o.prototype._getInitialState=function(){var t,e,n,i,o,s;if(n={},t=this._runMixinMethod("getInitialState"),r.isArray(t))for(s=this._runMixinMethod("getInitialState"),i=0,o=s.length;o>i;i++)e=s[i],r.extend(n,e);return r.extend(n,this.getInitialState()),n},o.prototype._optimistRender=function(t){var e;return"object"==typeof t?r.extend(this.state,t):this.state=t,e=function(e){return function(){return e._initialRender&&("function"==typeof e.initialRender&&e.initialRender(t),e._initialRender=!1),e._runMixinMethod("render",t),e.render(t),setTimeout(e.proxy(e._clearComps),0)}}(this),this.constructor.templateNode||this.constructor.noTemplate?e():this.constructor.one("template-loaded",function(t){return function(){return t._parseNode(),e()}}(this)),this.node},o.prototype._getChildComp=function(t,e){var n,i;return null!=(n=this.child_components)&&null!=(i=n[t.$id])?i[e]:void 0},o.prototype._getAllChildComp=function(t){var e,n,i,r,o,s,u,l,p;if(t){u=null!=(s=this.child_components)?s[t.$id]:void 0,p=[];for(r in u)n=u[r],p.push(n);return p}e=[],l=this.child_components;for(i in l){o=l[i];for(r in o)n=o[r],e.push(n)}return e},o.prototype._clearComps=function(){var t,e,n,i;for(i=this._getAllChildComp(),e=0,n=i.length;n>e;e++)t=i[e],t._preserve||r.contains(document.documentElement,t.node[0])||t.destroy();return null},o.prototype._regChildComp=function(t,e,n){var i,r,o;if(i=(r=this.child_components)[o=e.$id]||(r[o]={}),null!=i[n])throw"child component already exist!";return i[n]=t,t},o.prototype._delChildComp=function(t,e){var n,i;return null!=(n=this.child_components)&&null!=(i=n[t.$id])?delete i[e]:void 0},o.prototype._parseRemixChild=function(){var t,e,n,i;if(this.remixChild&&"object"==typeof this.remixChild){n=this.remixChild,i=[];for(e in n)t=n[e],i.push(this.addChild(e,t));return i}},o.prototype._parseNode=function(){var t,e;return t=function(t){return function(){return t._parseRefs(),t._parseRemix(),t._parseEvents(),t._runMixinMethod("onNodeCreated"),t.onNodeCreated()}}(this),this.constructor.templateNode?(e=this.node,this.node=this.constructor.templateNode.clone(),e&&e.replaceWith(this.node),t()):this.constructor.noTemplate?t():this.node=r(r.parseHTML('<span class="loading">loading..</span>'))},o.prototype._parseRefs=function(){var t,e;return t=this.node.find("[ref]"),e=this.node.find("[remix]"),e.length&&(t=t.not(e.find("[ref]"))),t.each(function(t){return function(e,n){var i;return i=r(n),t.refs[i.attr("ref")]=i}}(this))},o.prototype._parseRemix=function(){var t;return t=function(t){return function(e){var n,i,o,s,u,l,p,h,c,d;n=r(e);try{c=n.data()}catch(f){throw s=f,"This build of Zepto does not support data() -> object"}for(u in c)d=c[u],0===d.indexOf("@")&&(l=d.substring(1),c[u]=null!=t[l]?t.proxy(t[l]):function(e){return function(){if(t[e])return t[e]();throw""+e+" does not exist"}}(l));if(o=n.attr("remix"),i=t[o],null==i){if(null==a[o])throw'Remixing child "'+o+'" does not exist';i=t.addChild(o,a[o])}return h=i(c,n.attr("key"),e),!h.constructor.noTemplate&&(p=n.attr("ref"))?t.refs[p]=h.node:void 0}}(this),this.node.find("[remix]").not(this.node.find("[remix] [remix]")).each(function(){return t(this)})},o.prototype._parseEvents=function(){var t,e,n,i,o,s,u,l,p,a;if(this.remixEvent&&"object"==typeof this.remixEvent){l=this.remixEvent,a=[];for(t in l){if(i=l[t],p=t.split(","),e=p[0],u=p[1],s=p[2],e=r.trim(e),null!=u&&(u=r.trim(u),null==s?(s=u,u=null):s=r.trim(s)),n=function(t){return function(e){return function(n){var i;if(i=t[e],null==i)throw"handler "+e+" not found";return null!=i?i.call(t,n):void 0}}}(this)(i),o=s?"@"===s?this.node:this.refs[s]:this.node,null==o)throw"Event's referencing node \""+s+'" does not exist';a.push(u?o.on(e,u,n):o.on(e,n))}return a}return"function"==typeof this.remixEvent?(this.remixEvent=this.remixEvent(),this._parseEvents()):void 0},o.prototype._runMixinMethod=function(){var e,n,i,o,s,u,l,p;if(i=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],r.isArray(this.mixins)){for(u=this.mixins,p=[],o=0,s=u.length;s>o;o++)n=u[o],p.push(null!=(l=n[i])&&"function"==typeof l.apply?l.apply(this,e):void 0);return p}},o}(p),u=new o,a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.include(s),e.id_counter=1,e.create=function(t,s){var l,p,a,h,c,d,f,m,y;for(null==s&&(s=t,t=null),r.isArray(s.mixins)||(s.mixins=null!=s.mixins?[s.mixins]:[]),y=s.mixins,f=0,m=y.length;m>f;f++){h=y[f];for(a in h)n.call(h,a)&&(d=h[a],null==o.prototype[a]&&null==s[a]&&(s[a]=d))}return l=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.include(s),n.loadTemplate(s.template),n.$id=e.id_counter++,n}(o),c=function(t){var e;return e=function(n,i,o){var s;return o=r(o).get(0),i||(i="$default"),s=t._getChildComp(l,i),s||(s=new l(t,o),s.creator=e,s.key=i,t._regChildComp(s,l,i)),s._optimistRender(n),s},e.setParent=c,e.bindNode=function(t,n){return e({},n,t),e},e.get=function(e){return e||(e="$default"),t._getChildComp(l,e)},e.getAll=function(){return t._getAllChildComp(l)},e.destroyAll=function(){return r.each(e.getAll(),function(t,e){return e.destroy()})},e},p=c(u),t&&(e[t]=p),p},e}(p)})}).call(this);